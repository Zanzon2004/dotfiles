#!/usr/bin/env bash

iface=$(nmcli -t -f DEVICE,TYPE,STATE dev | awk -F: '$2=="wifi" && $3=="connected"{print $1; exit}')
conn=$(nmcli -t -f GENERAL.CONNECTION dev show "$iface" 2>/dev/null | cut -d: -f2)

[ -z "$iface" ] && status="down" || status="up"

case "$BLOCK_BUTTON" in
    1)
        if [ "$status" = "up" ]; then
            notify-send "Wi-Fi" "$(nmcli -f GENERAL.CONNECTION,GENERAL.STATE,IP4.ADDRESS,IP4.GATEWAY,IP4.DNS dev show "$iface" 2>/dev/null)"
        else
            notify-send "Wi-Fi" "No connection"
        fi
        kill -RTMIN+7 $(pidof dwmblocks) ;;
    2) "$TERMINAL" -e nmtui ;;
    3) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

if [ "$status" = "up" ]; then
    printf "❘ "
else
    printf "❘ 󰖪"
fi
